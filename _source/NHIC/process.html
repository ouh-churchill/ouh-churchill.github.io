

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TRA Processing &mdash; Diakonia v0.2.4 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Diakonia v0.2.4 documentation" href="../../index.html"/>
        <link rel="up" title="NHIC-TRA Project" href="index.html"/>
        <link rel="next" title="Mapping notes" href="mapping_notes.html"/>
        <link rel="prev" title="Introduction" href="introduction.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Diakonia
          

          
          </a>

          
            
            
              <div class="version">
                v0.2.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">About Diakonia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_stories.html">User Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Project Setup Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html#dev-system-notes">Dev System Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../BMT/index.html">BMT Project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">NHIC-TRA Project</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TRA Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#design">Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="#work-plan">Work plan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plan-as-of-2-6-16">Plan as of 2/6/16</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plan-as-of-19-5-16">Plan as of 19/5/16</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plan-as-of-14-4-16">Plan as of 14/4/16</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plan-as-of-3-3-16">Plan as of 3/3/16</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mapping_notes.html">Mapping notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-models">Data models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../FHIRstation/index.html">FHIRstation Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PancreasDB/index.html">Pancreas DB Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TransplantEPR/index.html">Transplant EPR Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes.html">Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project_management.html">Project Management</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Diakonia</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">NHIC-TRA Project</a> &raquo;</li>
        
      <li>TRA Processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_source/NHIC/process.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tra-processing">
<span id="tra-processing"></span><h1>TRA Processing<a class="headerlink" href="#tra-processing" title="Permalink to this headline">¶</a></h1>
<p>The overall aim here is to merge as many data sources as required together, into a complete submission for the NIHR-HIC theme.</p>
<p>This primarily means mapping the NHSBT dataset to the NHIC xsd specification, but the gaps in that dataset need to be filled with H&amp;I data, and Biopsy report data.</p>
<div class="section" id="design">
<span id="design"></span><h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p>Basic principle is to generate a schema that maps to the NHIC xsd closely, and to extend that schema with any additional data that may be useful from the local sources.</p>
<p>Process will involve loading an NHSBT data sample into an empty datastore, and then mapping the H&amp;I and Biopsy data to those records. Finally it should be possible to generate the XML export file.</p>
<p>v1 can treat this as a manual CLI process with import commands, and an export command.</p>
<p>v2 can put some analytics and display information into a UI and allow files to be uploaded and downloaded from that portal.</p>
</div>
<div class="section" id="work-plan">
<span id="work-plan"></span><h2>Work plan<a class="headerlink" href="#work-plan" title="Permalink to this headline">¶</a></h2>
<div class="section" id="plan-as-of-2-6-16">
<span id="plan-as-of-2-6-16"></span><h3>Plan as of 2/6/16<a class="headerlink" href="#plan-as-of-2-6-16" title="Permalink to this headline">¶</a></h3>
<p>Working on the <code class="docutils literal"><span class="pre">export_xml</span></code> command, using the <code class="docutils literal"><span class="pre">xml.minidom</span></code> to generate an xsd compatible file. Basic outlining work in progress, with mapping work to begin soon. Then we look to get the <code class="docutils literal"><span class="pre">load_nhsbt</span></code> command to import the xlsx data via the relevant forms into the data model.</p>
</div>
<div class="section" id="plan-as-of-19-5-16">
<span id="plan-as-of-19-5-16"></span><h3>Plan as of 19/5/16<a class="headerlink" href="#plan-as-of-19-5-16" title="Permalink to this headline">¶</a></h3>
<p>Background:</p>
<ul class="simple">
<li>Generate DS didn't give any useful structure from the XSD because the XSD lacks any useful structure (for starters, there is no definition of what the root &quot;record&quot; element represents!)</li>
<li>XSD parsing with Oxygen XML Editor and some consultation with other Oxford BRC members concluded that this isn't a helpful schema. Reference was then made to a set of UML models created 2 years ago at the start of this project. Reviewing those gave me a better starting point.</li>
<li>No information or data structure examples have been received from GSTT</li>
<li>Now have derived an initial model structure to handle Transplant data, with the emphasis on being Organ-centric. Organs are moved between people (the Donor and Recipient) via Operations, and the Recipient Person is given the most medical attention with Followups and Pre-operation investigations. The Donor Person may or may not be alive when the organ(s) are extracted. One Operation can handle multiple Organs (both extraction from Donor, and transplanting/grafting onto Recipient) so a web of data should emerge over time, though mostly in fairly small clusters.</li>
<li>It should be noted that this schema implicitly presumes Kidneys are the organs of choice.</li>
<li>We have a basic mapping of NHSBT xlxs data to the XSD data based on previous submission work and a document from the project archive.</li>
</ul>
<p>Next steps:</p>
<ol class="simple">
<li>We have a basic Excel Util to load the NHSBT data. Need to map that onto the new data models</li>
</ol>
<ul class="simple">
<li>Generate model forms - DONE</li>
<li>Mapping exercise...</li>
<li>Write a CLI function to take the xlsx file and ingest it</li>
</ul>
<ol class="simple">
<li>JF has created views onto the PSS system to get more information for this, so we need to get a list of what, and then map that accordingly</li>
</ol>
<ul class="simple">
<li>How we'll receive and can query this data is still unknown, so the implementation of this stage is vague.</li>
</ul>
<ol class="simple">
<li>All the translated and unit/type fields need examination to ensure we have the correct data types defined for capturing the information sensibly</li>
</ol>
<ul class="simple">
<li>Find a friendly clinician as a starting point and/or wikipedia/google</li>
</ul>
<ol class="simple">
<li>Mapping of the data model into the XSD, and outputing an XML file from a template design</li>
</ol>
<ul class="simple">
<li>Generate an XML template and corresponding view</li>
<li>Start basic and see what validateds</li>
</ul>
</div>
<div class="section" id="plan-as-of-14-4-16">
<span id="plan-as-of-14-4-16"></span><h3>Plan as of 14/4/16<a class="headerlink" href="#plan-as-of-14-4-16" title="Permalink to this headline">¶</a></h3>
<p>...is to use the existing (poor) XSD to test the process, and then to work on a more sensible XSD and data model.</p>
<ul class="simple">
<li>Example data structure to come from GSTT/Syed</li>
<li>Looking at the data structure again, can develop a much simpler DB model, and ultimately, xsd. So, build new model, then do the import, and export processes</li>
</ul>
</div>
<div class="section" id="plan-as-of-3-3-16">
<span id="plan-as-of-3-3-16"></span><h3>Plan as of 3/3/16<a class="headerlink" href="#plan-as-of-3-3-16" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li>Setup dev environment - DONE</li>
<li>Generate a model structure based on the NHIC xsd, and explore</li>
</ol>
<ul class="simple">
<li>generateDS code is semi-functional</li>
<li>Can use the pypi code to generate utility classes</li>
<li>Getting Django classes from it isn't working</li>
<li>Requires that you download the package source code and run as scripts - DONE</li>
<li>But the scripts don't run under python2, nor under python3, though they get closer on the latter</li>
<li>Debugging those scripts via 2to3 and some edits has now got them working.</li>
<li>The importlib process has a problem with xsd files containing periods, thus have renamed the xsd to <code class="docutils literal"><span class="pre">NHIC_TRA_1-6-0.xsd</span></code></li>
<li>Running instructions from <a class="reference external" href="http://www.davekuhlman.org/generateDS.html#examples-and-demonstrations">generateDS Django docs</a> results in a command of <code class="docutils literal"><span class="pre">./gends_run_gen_django.py</span> <span class="pre">-f</span> <span class="pre">NHIC_TRA_1-6-0.xsd</span></code></li>
<li>This creates admin, models, and forms .py files.</li>
<li>Moved the raw code across, but finding various helpful bits missing - like the description text being used for verbose_name, FK's not having their null attribute set, etc. The GenerateDS functions are very rudimentary in their approach, but non-trivial to amend, so doing a manual update from XSD to <code class="docutils literal"><span class="pre">ingest/models.py</span></code></li>
<li>... This process is paused pending rewrite/review of the XSD</li>
</ul>
<ol class="simple">
<li>Write utils to load the excel sheet</li>
</ol>
<ul class="simple">
<li>Initial load utils created</li>
<li>Column dictionary generated with NHSBT headers, and comments linking to their NHIC mapping id</li>
</ul>
<ol class="simple">
<li>Build input forms to validate and map the data into the model</li>
<li>Add in lots of logging to record data transformation/substitution changes</li>
</ol>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mapping_notes.html" class="btn btn-neutral float-right" title="Mapping notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, University of Oxford &amp; Oxford Universities NHS Foundatation Trust.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'v0.2.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>